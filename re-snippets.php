<?php
/**
 * Plugin Name: RB Snippets
 * Description: Набор полезных снипетов для быстрого запуска сайта.
 * Version:     1.0.3
 * Author:      Roman Bolandeu
 * GitHub Plugin URI: https://github.com/bolandeu/rb-snippets
 */

if (!defined('ABSPATH')) exit;


// ============================================================================
// 1. ОБНОВЛЕНИЯ ПЛАГИНА ЧЕРЕЗ GITHUB
// ============================================================================
if (file_exists(__DIR__ . '/vendors/plugin-update-checker/plugin-update-checker.php')) {
    require_once __DIR__ . '/vendors/plugin-update-checker/plugin-update-checker.php';

    $myUpdateChecker = \YahnisElsts\PluginUpdateChecker\v5\PucFactory::buildUpdateChecker(
        'https://github.com/bolandeu/rb-snippets/',
        __FILE__,
        'rb-snippets'
    );
    $myUpdateChecker->setBranch('main');
}


// ============================================================================
// 2. БАЗОВЫЕ СНИППЕТЫ (всегда активны)
// ============================================================================

// Шорткоды: [domain], [url], [page_content]
require_once __DIR__ . '/inc/shortcodes.php';

// IMask: маска для полей ввода телефона (класс .phone-input)
require_once __DIR__ . '/inc/imask/imask.php';

// SEO: подмена H1 из ACF полей для записей и таксономий
require_once __DIR__ . '/inc/seo.php';

// ============================================================================
// 3. ACF НАСТРОЙКИ САЙТА (требуется ACF Pro)
// ============================================================================

// Страница "Настройки сайта" с вкладками: Интеграции, SMTP и др.
// Все настройки хранятся в БД и не перезаписываются при обновлении плагина
require_once __DIR__ . '/inc/acf-site-settings.php';


// ============================================================================
// 4. АНАЛИТИКА И ОТСЛЕЖИВАНИЕ
// ============================================================================

// UTM Tracker: сохранение UTM-меток в сессию и cookies
// Функция: rb_get_utm_params() для получения меток
require_once __DIR__ . '/inc/utm-tracker.php';

// Яндекс.Метрика: счетчик + отслеживание событий (клики, копирование, формы)
// Настройка: Настройки сайта → Интеграции → ID счетчика Яндекс.Метрики
require_once __DIR__ . '/inc/tag-manager.php';

// Sourcebuster.js: отслеживание источников трафика + подмена телефонов
// Настройка: Настройки сайта → Интеграции → Телефоны
require_once __DIR__ . '/inc/sourcebuster/sourcebuster.php';


// ============================================================================
// 5. ИНТЕГРАЦИИ С CRM И МЕССЕНДЖЕРАМИ
// ============================================================================

// Contact Form 7 → Битрикс24: отправка заявок в CRM
// Настройка: Настройки сайта → Интеграции → Битрикс24 Webhook URL
require_once __DIR__ . '/inc/cf7-bitrix24.php';

// Contact Form 7 → Telegram: уведомления о заявках в бота
// Настройка: Настройки сайта → Интеграции → Telegram Bot Token / Chat ID
require_once __DIR__ . '/inc/cf7-telegram.php';

// SMTP настройки для отправки почты
// Настройка: Настройки сайта → SMTP
require_once __DIR__ . '/inc/smtp.php';


// ============================================================================
// 6. ACF РАСШИРЕНИЯ (раскомментируйте при необходимости)
// ============================================================================

// Шорткод [sf] для вывода полей ACF
require_once __DIR__ . '/inc/acf-shortcode.php';

// REST API для ACF Options (GET/POST) и любых типов записей и таксономий
require_once __DIR__ . '/inc/rest-api-extensions.php';

// Permalink Manager Pro: REST API интеграция
require_once __DIR__ . '/inc/permalink-manager-rest.php';


// ============================================================================
// 7. СТРАНИЦА ПОМОЩИ В АДМИНКЕ
// ============================================================================
require_once __DIR__ . '/inc/admin-help-page.php';


// ============================================================================
// 8. УЛУЧШЕНИЕ АДМИНКи
// ============================================================================
require_once __DIR__ . '/inc/admin-manage.php';


// ============================================================================
// 9. РАСШИРЕНИЯ ДЛЯ ТЕМ
// ============================================================================

// Blocksy: добавление соцсетей (Дзен, Rutube) - только если активна тема Blocksy
require_once __DIR__ . '/inc/blocksy.php';